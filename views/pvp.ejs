<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PVP - ìŠ¤í„°ë”” í”Œë˜ë„ˆ</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #f5f7fa;
    padding: 24px;
}

.container {
    max-width: 1000px;
    margin: 0 auto;
}

.page-header {
    background: white;
    padding: 24px;
    border-radius: 8px;
    margin-bottom: 24px;
    border: 1px solid #e8e8e8;
}

.page-header h1 {
    font-size: 24px;
    font-weight: 600;
    color: #262626;
}

.nav-menu {
    background: white;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 24px;
    border: 1px solid #e8e8e8;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.nav-menu a {
    padding: 10px 18px;
    border-radius: 4px;
    text-decoration: none;
    font-size: 14px;
    color: #595959;
    font-weight: 500;
}

.nav-menu a.active,
.nav-menu a:hover {
    background: #e6f7ff;
    color: #1890ff;
}

.card {
    background: white;
    border-radius: 8px;
    padding: 24px;
    border: 1px solid #e8e8e8;
}

.match-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.player {
    text-align: center;
    flex: 1;
}

.player-name {
    font-size: 18px;
    font-weight: 600;
}

.player-status {
    font-size: 13px;
    color: #8c8c8c;
}

.vs {
    font-size: 20px;
    font-weight: 700;
    color: #1890ff;
}

.timer {
    text-align: center;
    background: #fafafa;
    border: 1px solid #f0f0f0;
    border-radius: 6px;
    padding: 16px;
    margin-bottom: 24px;
}

.timer-label {
    font-size: 13px;
    color: #8c8c8c;
}

.timer-display {
    font-size: 32px;
    font-weight: 700;
    color: #1890ff;
}

.timer-display.warning {
    color: #ff4d4f;
}

.problem-question {
    background: #fafafa;
    border: 1px solid #f0f0f0;
    border-radius: 6px;
    padding: 20px;
    margin-bottom: 20px;
    font-size: 16px;
    line-height: 1.7;
}

.options-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.option {
    border: 1px solid #f0f0f0;
    background: #fafafa;
    border-radius: 6px;
    padding: 14px;
    cursor: pointer;
    display: flex;
    gap: 12px;
}

.option:hover {
    border-color: #1890ff;
    background: #e6f7ff;
}

.option.selected {
    border-color: #1890ff;
    background: #e6f7ff;
}

.option input {
    cursor: pointer;
}

.submit-btn {
    margin-top: 20px;
    width: 100%;
    padding: 14px;
    background: #1890ff;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
}

.submit-btn:disabled {
    background: #d9d9d9;
    cursor: not-allowed;
}

.result-container {
    text-align: center;
    padding: 40px;
    border-radius: 8px;
    background: #fafafa;
    border: 1px solid #f0f0f0;
}

.result-title {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 16px;
}

.result-win { color: #52c41a; }
.result-lose { color: #ff4d4f; }
.result-draw { color: #faad14; }

.result-detail {
    font-size: 15px;
    color: #595959;
    margin-bottom: 24px;
}

.button-group {
    display: flex;
    gap: 12px;
}

.btn {
    flex: 1;
    padding: 12px;
    border-radius: 6px;
    font-weight: 600;
    text-decoration: none;
    text-align: center;
}

.btn-primary {
    background: #1890ff;
    color: white;
}

.btn-secondary {
    background: #fafafa;
    border: 1px solid #d9d9d9;
    color: #595959;
}

.waiting {
    text-align: center;
    padding: 60px 20px;
    color: #8c8c8c;
}
</style>
</head>

<body>
<div class="container">

<div class="page-header">
    <h1>âš”ï¸ PVP ëŒ€ê²°</h1>
</div>

<div class="nav-menu">
    <a href="/">í™ˆ</a>
    <a href="/todo">í•  ì¼</a>
    <a href="/calendar">ë‹¬ë ¥</a>
    <a href="/ranking">ë­í‚¹</a>
    <a href="/problem">ë¬¸ì œ í’€ì´</a>
    <a href="/pvp" class="active">PVP</a>
</div>

<div class="card">

<% if (match && match.status === 'in_progress') { %>

<div class="match-info">
    <div class="player">
        <div class="player-name"><%= user.username %></div>
        <div class="player-status">ë‚˜</div>
    </div>
    <div class="vs">VS</div>
    <div class="player">
        <div class="player-name"><%= opponent.username %></div>
        <div class="player-status">ìƒëŒ€</div>
    </div>
</div>

<div class="timer">
    <div class="timer-label">ë‚¨ì€ ì‹œê°„</div>
    <div class="timer-display" id="timer">5:00</div>
</div>

<div class="problem-question">
    <%= problem.question %>
</div>

<form id="pvpForm" method="POST" action="/pvp/submit">
<input type="hidden" name="_csrf" value="<%= csrfToken %>">
<input type="hidden" name="match_id" value="<%= match.id %>">

<div class="options-container">
<% for(let i=1;i<=5;i++){ %>
<label class="option" onclick="selectOption(this)">
    <input type="radio" name="answer" value="<%= i %>" required>
    <span><%= i %>. <%= problem['option'+i] %></span>
</label>
<% } %>
</div>

<button class="submit-btn" id="submitBtn">ì •ë‹µ ì œì¶œ</button>
</form>

<script>
let timeLeft = 300;
const timer = document.getElementById('timer');
const btn = document.getElementById('submitBtn');

setInterval(() => {
    timeLeft--;
    const m = Math.floor(timeLeft / 60);
    const s = timeLeft % 60;
    timer.textContent = `${m}:${s.toString().padStart(2,'0')}`;
    if(timeLeft <= 30) timer.classList.add('warning');
    if(timeLeft <= 0){
        btn.disabled = true;
        document.getElementById('pvpForm').submit();
    }
},1000);

function selectOption(el){
    document.querySelectorAll('.option').forEach(o=>o.classList.remove('selected'));
    el.classList.add('selected');
}
</script>

<% } else if (match && match.status === 'finished') { %>

<div class="result-container">
    <div class="result-title <%= match.winner_id === user.id ? 'result-win' : match.winner_id === opponent.id ? 'result-lose' : 'result-draw' %>">
        <%= match.winner_id === user.id ? 'ğŸ‰ ìŠ¹ë¦¬' : match.winner_id === opponent.id ? 'íŒ¨ë°°' : 'ë¬´ìŠ¹ë¶€' %>
    </div>
    <div class="result-detail">
        ì •ë‹µ: <%= problem.answer %>ë²ˆ<br>
        ë‚˜: <%= myAnswer || 'ë¯¸ì œì¶œ' %><br>
        ìƒëŒ€: <%= opponentAnswer || 'ë¯¸ì œì¶œ' %>
    </div>
    <div class="button-group">
        <a href="/ranking" class="btn btn-secondary">ë­í‚¹</a>
        <a href="/pvp?opponent=<%= opponent.id %>" class="btn btn-primary">ì¬ëŒ€ê²°</a>
    </div>
</div>

<% } else { %>

<div class="waiting">
    <p>ëŒ€ê²° ìƒëŒ€ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤</p>
    <a href="/ranking" class="btn btn-primary" style="margin-top:20px; display:inline-block;">ë­í‚¹ì—ì„œ ì„ íƒ</a>
</div>

<% } %>

</div>
</div>
</body>
</html>

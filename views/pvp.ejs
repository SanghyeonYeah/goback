<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PVP - Ïä§ÌÑ∞Îîî ÌîåÎûòÎÑà</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #667eea;
            font-size: 28px;
            text-align: center;
        }

        .nav-menu {
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-menu a {
            padding: 12px 24px;
            background: #f0f0f0;
            color: #333;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .nav-menu a:hover, .nav-menu a.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
        }

        .pvp-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .match-info {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
        }

        .player {
            text-align: center;
            flex: 1;
        }

        .player-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .player-status {
            font-size: 14px;
            opacity: 0.9;
        }

        .vs {
            font-size: 36px;
            font-weight: bold;
            padding: 0 30px;
        }

        .timer {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .timer-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .timer-display {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
        }

        .timer-display.warning {
            color: #f5576c;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .problem-section {
            margin-bottom: 30px;
        }

        .problem-question {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            line-height: 1.8;
            font-size: 18px;
            color: #333;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }

        .option {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 2px solid transparent;
        }

        .option:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .option.selected {
            border-color: #667eea;
            background: #e3f2fd;
        }

        .option input[type="radio"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .option-text {
            flex: 1;
            font-size: 16px;
            color: #333;
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .result-container {
            background: #f8f9fa;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
        }

        .result-win {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        }

        .result-lose {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        }

        .result-draw {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        }

        .result-title {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .result-win .result-title {
            color: #155724;
        }

        .result-lose .result-title {
            color: #721c24;
        }

        .result-draw .result-title {
            color: #856404;
        }

        .result-detail {
            font-size: 20px;
            color: #666;
            margin-bottom: 30px;
        }

        .button-group {
            display: flex;
            gap: 15px;
        }

        .back-btn {
            flex: 1;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .rematch-btn {
            flex: 1;
            padding: 15px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .waiting-message {
            text-align: center;
            padding: 60px 20px;
            font-size: 18px;
            color: #666;
        }

        .loading {
            display: inline-block;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öîÔ∏è PVP ÎåÄÍ≤∞</h1>
        </div>

        <div class="nav-menu">
            <a href="/">Ìôà</a>
            <a href="/todo">Ìï† Ïùº</a>
            <a href="/calendar">Îã¨Î†•</a>
            <a href="/ranking">Îû≠ÌÇπ</a>
            <a href="/problem">Î¨∏Ï†ú ÌíÄÏù¥</a>
            <a href="/pvp" class="active">PVP</a>
        </div>

        <div class="pvp-container">
            <% if (match && match.status === 'in_progress') { %>
                <div class="match-info">
                    <div class="player">
                        <div class="player-name"><%= user.username %></div>
                        <div class="player-status">ÎÇò</div>
                    </div>
                    <div class="vs">VS</div>
                    <div class="player">
                        <div class="player-name"><%= opponent.username %></div>
                        <div class="player-status">ÏÉÅÎåÄÎ∞©</div>
                    </div>
                </div>

                <div class="timer">
                    <div class="timer-label">ÎÇ®ÏùÄ ÏãúÍ∞Ñ</div>
                    <div class="timer-display" id="timer">5:00</div>
                </div>

                <div class="problem-section">
                    <div class="problem-question">
                        <%= problem.question %>
                    </div>

                    <form id="pvpForm" method="POST" action="/pvp/submit">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <input type="hidden" name="match_id" value="<%= match.id %>">
                        
                        <div class="options-container">
                            <% for (let i = 1; i <= 5; i++) { %>
                                <label class="option" onclick="selectOption(this)">
                                    <input type="radio" name="answer" value="<%= i %>" required>
                                    <span class="option-text">
                                        <%= i %>. <%= problem['option' + i] %>
                                    </span>
                                </label>
                            <% } %>
                        </div>

                        <button type="submit" class="submit-btn" id="submitBtn">Ï†ïÎãµ Ï†úÏ∂ú</button>
                    </form>
                </div>

                <script>
                    let timeLeft = 300;
                    const timerDisplay = document.getElementById('timer');
                    const submitBtn = document.getElementById('submitBtn');

                    const timer = setInterval(() => {
                        timeLeft--;
                        const minutes = Math.floor(timeLeft / 60);
                        const seconds = timeLeft % 60;
                        timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

                        if (timeLeft <= 30) {
                            timerDisplay.classList.add('warning');
                        }

                        if (timeLeft <= 0) {
                            clearInterval(timer);
                            submitBtn.disabled = true;
                            alert('ÏãúÍ∞ÑÏù¥ Ï¢ÖÎ£åÎêòÏóàÏäµÎãàÎã§!');
                            document.getElementById('pvpForm').submit();
                        }
                    }, 1000);

                    function selectOption(label) {
                        document.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        label.classList.add('selected');
                    }
                </script>

            <% } else if (match && match.status === 'finished') { %>
                <% 
                    let resultClass = 'result-draw';
                    let resultText = 'Î¨¥ÏäπÎ∂Ä';
                    let resultEmoji = 'ü§ù';
                    
                    if (match.winner_id === user.id) {
                        resultClass = 'result-win';
                        resultText = 'ÏäπÎ¶¨!';
                        resultEmoji = 'üéâ';
                    } else if (match.winner_id === opponent.id) {
                        resultClass = 'result-lose';
                        resultText = 'Ìå®Î∞∞';
                        resultEmoji = 'üò¢';
                    }
                %>
                
                <div class="result-container <%= resultClass %>">
                    <div class="result-title"><%= resultEmoji %> <%= resultText %></div>
                    <div class="result-detail">
                        Ï†ïÎãµ: <%= problem.answer %>Î≤à<br>
                        <%= user.username %>: <%= myAnswer || 'ÎØ∏Ï†úÏ∂ú' %><br>
                        <%= opponent.username %>: <%= opponentAnswer || 'ÎØ∏Ï†úÏ∂ú' %>
                    </div>
                    
                    <div class="button-group">
                        <a href="/ranking" class="back-btn">Îû≠ÌÇπ Î≥¥Í∏∞</a>
                        <button class="rematch-btn" onclick="location.href='/pvp?opponent=<%= opponent.id %>'">
                            Ïû¨ÎåÄÍ≤∞
                        </button>
                    </div>
                </div>

            <% } else { %>
                <div class="waiting-message">
                    <div class="loading" style="font-size: 48px;">‚è≥</div>
                    <p style="margin-top: 20px;">ÎåÄÍ≤∞ ÏÉÅÎåÄÎ•º Ï∞æÍ≥† ÏûàÏäµÎãàÎã§...</p>
                    <p style="margin-top: 10px; color: #999;">Îû≠ÌÇπÏóêÏÑú ÏÉÅÎåÄÎ•º ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÎûúÎç§ Îß§Ïπ≠ÏùÑ Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.</p>
                    <div style="margin-top: 30px;">
                        <a href="/ranking" class="back-btn" style="max-width: 300px; margin: 0 auto;">
                            Îû≠ÌÇπÏóêÏÑú ÏÉÅÎåÄ ÏÑ†ÌÉùÌïòÍ∏∞
                        </a>
                    </div>
                </div>
            <% } %>
        </div>
    </div>
</body>
</html>